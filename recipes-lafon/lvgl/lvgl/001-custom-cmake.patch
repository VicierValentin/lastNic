From 06f9a63fd62ec5aa710cae455993d53422106b02 Mon Sep 17 00:00:00 2001
From: gattard <gregory.attard@lafon.fr>
Date: Fri, 8 Mar 2024 10:45:35 +0000
Subject: [PATCH] custom-cmake

---
 CMakeLists.txt                 |  2 +-
 env_support/cmake/custom.cmake | 42 +++++++++++++---------------------
 2 files changed, 17 insertions(+), 27 deletions(-)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index c1f72b8..75fbda1 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -1,7 +1,7 @@
 cmake_minimum_required(VERSION 3.12.4)
 
 if(NOT ESP_PLATFORM)
-  project(lvgl HOMEPAGE_URL https://github.com/lvgl/lvgl)
+  project(lvgl HOMEPAGE_URL https://github.com/lvgl/lvgl VERSION 8.3.0)
 endif()
 
 set(LVGL_ROOT_DIR ${CMAKE_CURRENT_LIST_DIR})
diff --git a/env_support/cmake/custom.cmake b/env_support/cmake/custom.cmake
index 1536710..534377a 100644
--- a/env_support/cmake/custom.cmake
+++ b/env_support/cmake/custom.cmake
@@ -4,19 +4,12 @@ option(LV_LVGL_H_INCLUDE_SIMPLE
 
 # Option to define LV_CONF_INCLUDE_SIMPLE, default: ON
 option(LV_CONF_INCLUDE_SIMPLE
-       "Simple include of \"lv_conf.h\" and \"lv_drv_conf.h\"" ON)
-
-# Option to set LV_CONF_PATH, if set parent path LV_CONF_DIR is added to
-# includes
-option(LV_CONF_PATH "Path defined for lv_conf.h")
-get_filename_component(LV_CONF_DIR ${LV_CONF_PATH} DIRECTORY)
+       "Simple include of \"lv_conf.h\" and \"lv_drv_conf.h\"" OFF)
 
 # Option to build shared libraries (as opposed to static), default: OFF
-option(BUILD_SHARED_LIBS "Build shared libraries" OFF)
+option(BUILD_SHARED_LIBS "Build shared libraries" ON)
 
 file(GLOB_RECURSE SOURCES ${LVGL_ROOT_DIR}/src/*.c)
-file(GLOB_RECURSE EXAMPLE_SOURCES ${LVGL_ROOT_DIR}/examples/*.c)
-file(GLOB_RECURSE DEMO_SOURCES ${LVGL_ROOT_DIR}/demos/*.c)
 
 if (BUILD_SHARED_LIBS)
   add_library(lvgl SHARED ${SOURCES})
@@ -25,30 +18,16 @@ else()
 endif()
 
 add_library(lvgl::lvgl ALIAS lvgl)
-add_library(lvgl_examples STATIC ${EXAMPLE_SOURCES})
-add_library(lvgl::examples ALIAS lvgl_examples)
-add_library(lvgl_demos STATIC ${DEMO_SOURCES})
-add_library(lvgl::demos ALIAS lvgl_demos)
 
 target_compile_definitions(
   lvgl PUBLIC $<$<BOOL:${LV_LVGL_H_INCLUDE_SIMPLE}>:LV_LVGL_H_INCLUDE_SIMPLE>
               $<$<BOOL:${LV_CONF_INCLUDE_SIMPLE}>:LV_CONF_INCLUDE_SIMPLE>)
 
 # Include root and optional parent path of LV_CONF_PATH
-target_include_directories(lvgl SYSTEM PUBLIC ${LVGL_ROOT_DIR} ${LV_CONF_DIR})
-
-# Include /examples folder
-target_include_directories(lvgl_examples SYSTEM
-                           PUBLIC ${LVGL_ROOT_DIR}/examples)
-target_include_directories(lvgl_demos SYSTEM
-                           PUBLIC ${LVGL_ROOT_DIR}/demos)
-
-target_link_libraries(lvgl_examples PUBLIC lvgl)
-target_link_libraries(lvgl_demos PUBLIC lvgl)
+target_include_directories(lvgl SYSTEM PUBLIC ${LVGL_ROOT_DIR})
 
 # Lbrary and headers can be installed to system using make install
-file(GLOB LVGL_PUBLIC_HEADERS "${CMAKE_SOURCE_DIR}/lv_conf.h"
-     "${CMAKE_SOURCE_DIR}/lvgl.h")
+file(GLOB LVGL_PUBLIC_HEADERS "${CMAKE_SOURCE_DIR}/lvgl.h")
 
 if("${LIB_INSTALL_DIR}" STREQUAL "")
   set(LIB_INSTALL_DIR "lib")
@@ -57,6 +36,15 @@ if("${INC_INSTALL_DIR}" STREQUAL "")
   set(INC_INSTALL_DIR "include/lvgl")
 endif()
 
+if("${LV_CONF_PATH}" STREQUAL "")
+  set(LV_CONF_PATH "include/")
+endif()
+
+install(
+  FILES "${CMAKE_SOURCE_DIR}/lv_conf.h"
+  DESTINATION "${CMAKE_INSTALL_PREFIX}/${LV_CONF_PATH}/")
+
+
 install(
   DIRECTORY "${CMAKE_SOURCE_DIR}/src"
   DESTINATION "${CMAKE_INSTALL_PREFIX}/${INC_INSTALL_DIR}/"
@@ -77,10 +65,12 @@ install(
 
 set_target_properties(
   lvgl
-  PROPERTIES OUTPUT_NAME lvgl
+  PROPERTIES OUTPUT_NAME "lvgl"
              ARCHIVE_OUTPUT_DIRECTORY "${CMAKE_BINARY_DIR}/lib"
              LIBRARY_OUTPUT_DIRECTORY "${CMAKE_BINARY_DIR}/lib"
              RUNTIME_OUTPUT_DIRECTORY "${CMAKE_BINARY_DIR}/lib"
+             VERSION "${PROJECT_VERSION}"
+             SOVERSION "${PROJECT_VERSION_MAJOR}"
              PUBLIC_HEADER "${LVGL_PUBLIC_HEADERS}")
 
 install(
-- 
2.25.1

