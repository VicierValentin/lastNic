From f27aa27b016dfe7bc2acb80209ef5e2546560b15 Mon Sep 17 00:00:00 2001
From: gattard <gregory.attard@lafon.fr>
Date: Fri, 8 Mar 2024 10:50:43 +0000
Subject: [PATCH] custom-cmake

---
 CMakeLists.txt | 22 ++++++++++++++++++----
 1 file changed, 18 insertions(+), 4 deletions(-)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index fadccaa..4f0dd5d 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -1,11 +1,12 @@
 cmake_minimum_required(VERSION 3.12.4)
 
-project(lv_drivers HOMEPAGE_URL https://github.com/lvgl/lv_drivers/)
+project(lv_drivers HOMEPAGE_URL https://github.com/lvgl/lv_drivers/ VERSION 8.3.0)
 
 # Option to build as shared library (as opposed to static), default: OFF
-option(BUILD_SHARED_LIBS "Build shared as library (as opposed to static)" OFF)
+option(BUILD_SHARED_LIBS "Build shared as library (as opposed to static)" ON)
 
 file(GLOB_RECURSE SOURCES ./*.c)
+list(FILTER SOURCES EXCLUDE REGEX .pc/*)
 
 if (BUILD_SHARED_LIBS)
   add_library(lv_drivers SHARED ${SOURCES})
@@ -27,9 +28,19 @@ if("${LIB_INSTALL_DIR}" STREQUAL "")
 endif()
 
 if("${INC_INSTALL_DIR}" STREQUAL "")
-  set(INC_INSTALL_DIR "include/lvgl/lv_drivers")
+  set(INC_INSTALL_DIR "include/lv_drivers")
 endif()
 
+if("${LV_DRVCONF_PATH}" STREQUAL "")
+  set(LV_DRVCONF_PATH "include")
+endif()
+
+install(
+  FILES "${CMAKE_SOURCE_DIR}/lv_drv_conf.h"
+  DESTINATION "${CMAKE_INSTALL_PREFIX}/${LV_DRVCONF_PATH}/"
+)
+
+
 install(
   DIRECTORY "${CMAKE_SOURCE_DIR}/"
   DESTINATION "${CMAKE_INSTALL_PREFIX}/${INC_INSTALL_DIR}/"
@@ -37,10 +48,11 @@ install(
   PATTERN "*.h"
   PATTERN ".git*" EXCLUDE
   PATTERN "CMakeFiles" EXCLUDE
+  PATTERN "lv_drv*.h" EXCLUDE
   PATTERN "docs" EXCLUDE
   PATTERN "lib" EXCLUDE)
 
-file(GLOB LV_DRIVERS_PUBLIC_HEADERS "${CMAKE_SOURCE_DIR}/lv_drv_conf.h")
+file(GLOB LV_DRIVERS_PUBLIC_HEADERS)
 
 set_target_properties(
   lv_drivers
@@ -48,6 +60,8 @@ set_target_properties(
              ARCHIVE_OUTPUT_DIRECTORY "${CMAKE_BINARY_DIR}/lib"
              LIBRARY_OUTPUT_DIRECTORY "${CMAKE_BINARY_DIR}/lib"
              RUNTIME_OUTPUT_DIRECTORY "${CMAKE_BINARY_DIR}/lib"
+             VERSION "${PROJECT_VERSION}"
+             SOVERSION "${PROJECT_VERSION_MAJOR}"
              PUBLIC_HEADER "${LV_DRIVERS_PUBLIC_HEADERS}")
 
 install(
-- 
2.25.1

