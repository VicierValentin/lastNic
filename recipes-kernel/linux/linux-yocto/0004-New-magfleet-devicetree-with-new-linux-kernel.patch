From e89deb6460546279b6d00ae89c66779d1d0f2f2e Mon Sep 17 00:00:00 2001
From: cdemenou <charles.demenou@madic.com>
Date: Wed, 22 Jan 2025 14:21:57 +0100
Subject: [PATCH] New-magfleet-devicetree-with-new-linux-kernel

---
 arch/arm/boot/dts/am335x-boneblack.dts | 269 ++++++++++++++++++++++++-
 1 file changed, 261 insertions(+), 8 deletions(-)

diff --git a/arch/arm/boot/dts/am335x-boneblack.dts b/arch/arm/boot/dts/am335x-boneblack.dts
index 9312197316f0..bf77d945a4da 100644
--- a/arch/arm/boot/dts/am335x-boneblack.dts
+++ b/arch/arm/boot/dts/am335x-boneblack.dts
@@ -42,14 +42,14 @@ &gpio0 {
 		"P9_20 [i2c2_sda]",
 		"P9_19 [i2c2_scl]",
 		"P9_26 [uart1_rxd]",
-		"P9_24 [uart1_txd]",
+		"reset_tactile",
 		"[rmii1_txd3]",
 		"[rmii1_txd2]",
 		"[usb0_drvvbus]",
 		"[hdmi cec]",
 		"P9_41B",
 		"[rmii1_txd1]",
-		"P8_19 [ehrpwm2a]",
+		"backlight",
 		"P8_13 [ehrpwm2b]",
 		"NC",
 		"NC",
@@ -79,10 +79,10 @@ &gpio1 {
 		"P8_11",
 		"P8_16",
 		"P8_15",
-		"P9_15A",
-		"P9_23",
+		"config_btn",
+		"interrupteur_mid",
 		"P9_14 [ehrpwm1a]",
-		"P9_16 [ehrpwm1b]",
+		"rs485_de",
 		"[emmc rst]",
 		"[usr0 led]",
 		"[usr1 led]",
@@ -101,8 +101,8 @@ &gpio2 {
 	gpio-line-names =
 		"P9_15B",
 		"P8_18",
-		"P8_7",
-		"P8_8",
+		"resistance116",
+		"resistance117",
 		"P8_10",
 		"P8_9",
 		"P8_45 [hdmi]",
@@ -154,7 +154,7 @@ &gpio3 {
 		"P9_30 [spi1_d1]",
 		"P9_28 [spi1_cs0]",
 		"P9_42B [ecappwm0]",
-		"P9_27",
+		"buzzer",
 		"P9_41A",
 		"P9_25",
 		"NC",
@@ -168,3 +168,256 @@ &gpio3 {
 		"NC",
 		"NC";
 };
+
+&am33xx_pinmux{
+                        bb_configbtn_pins: pinmux_bb_configbtn_pins {
+                                pinctrl-single,pins = <
+									AM33XX_PADCONF(AM335X_PIN_GPMC_A0, PIN_INPUT | SLEWCTRL_SLOW, MUX_MODE7)//0x040 0x37	// Input
+                                >;
+                        };
+
+                        bb_i2c1_pins: pinmux_bb_i2c1_pins {
+                                pinctrl-single,pins = <
+									AM33XX_PADCONF(AM335X_PIN_SPI0_CS0, PIN_INPUT_PULLUP, MUX_MODE2) /* AM335X_PIN_SPI0_CS0, OMAP_MUX_MODE2 | AM33XX_PIN_INPUT*/
+									AM33XX_PADCONF(AM335X_PIN_SPI0_D1, PIN_INPUT_PULLUP, MUX_MODE2) /* AM335X_PIN_SPI0_D1, OMAP_MUX_MODE2 | AM33XX_PIN_INPUT*/
+                                >;
+                        };
+
+                        bb_irq_pins: pinmux_bb_irq_pins {
+                                pinctrl-single,pins = <
+									AM33XX_PADCONF(AM335X_PIN_GPMC_A2, PIN_INPUT | SLEWCTRL_SLOW, MUX_MODE7) //0x048 0x37
+                                >;
+                        };
+
+						pwm_backlight_pins: pinmux_bb_lcd_pwm_backlight_pins {
+							pinctrl-single,pins = <
+									AM33XX_PADCONF(AM335X_PIN_GPMC_AD8, PIN_OUTPUT, MUX_MODE4)/*0x020 0x04  gpmc_a2.ehrpwm2a, OMAP_MUX_MODE4 | AM33XX_PIN_OUTPUT */
+								>;
+						};
+
+                        led_pin: pinmux_led_pin {
+                                pinctrl-single,pins = <
+									AM33XX_PADCONF(AM335X_PIN_GPMC_AD13, PIN_OUTPUT, MUX_MODE7) // 0x034 0x07 OMAP_MUX_MODE7 | AM33XX_PIN_OUTPUT
+									AM33XX_PADCONF(AM335X_PIN_GPMC_AD12, PIN_OUTPUT, MUX_MODE7) // 0x030 0x07
+								>;
+						};
+
+                        rs485_pin: pinmux_rs485_pin {
+                                pinctrl-single,pins = <
+									AM33XX_PADCONF(AM335X_PIN_GPMC_A3, PIN_OUTPUT, MUX_MODE7) // 0x04C0 0x07 gpio1.19, OMAP_MUX_MODE7 | AM33XX_PIN_OUTPUT
+								>;
+						};
+
+                        buzzer_pin: pinmux_buzzer_pin {
+                                pinctrl-single,pins = <
+								AM33XX_PADCONF(AM335X_PIN_MCASP0_FSR, PIN_OUTPUT, MUX_MODE7)  /*0x1A4 0x07  gpio3.19, OMAP_MUX_MODE7 | AM33XX_PIN_OUTPUT */
+								>;
+						};
+
+						uart2_pins: pinmux-uart2-pins {
+								pinctrl-single,pins = <
+									AM33XX_PADCONF(AM335X_PIN_SPI0_D0, PIN_OUTPUT_PULLUP, MUX_MODE1)	/* (B17) gpmc_spi0_d0.uart2_txd */
+									AM33XX_PADCONF(AM335X_PIN_SPI0_SCLK, PIN_INPUT, MUX_MODE1)	/* (A17) gpmc_spi0_sclk.uart2_rxd */
+								>;
+						};
+										
+						interrupteur_mid_pin: pinmux-interrupteur_mid_pin {
+								pinctrl-single,pins = <
+									AM33XX_PADCONF(AM335X_PIN_GPMC_A1, PIN_INPUT_PULLDOWN, MUX_MODE7) /*Pin address 0x044 0x07  gpio1.17, OMAP_MUX_MODE7 | AM33XX_PIN_INPUT */
+								>;
+						};
+										
+						dalle_tactile_reset_pin: pinmux-dalle_tactile_reset_pin {
+								pinctrl-single,pins = <
+									AM33XX_PADCONF(AM335X_PIN_UART1_TXD, PIN_OUTPUT, MUX_MODE7) /*Pin address 0x0184 0x07  gpio0.15, OMAP_MUX_MODE7 | AM33XX_PIN_OUTPUT */
+								>;
+						};
+						
+						resistance_indice_carte_pin: pinmux-resistance_indice_carte_pin {
+								pinctrl-single,pins = <
+									AM33XX_PADCONF(AM335X_PIN_GPMC_ADVN_ALE, PIN_INPUT, MUX_MODE7) /*Pin address 0x090 0x07  gpio2.2, OMAP_MUX_MODE7 | AM33XX_PIN_INPUT */
+									AM33XX_PADCONF(AM335X_PIN_GPMC_OEN_REN, PIN_INPUT, MUX_MODE7) /*Pin address 0x094 0x07  gpio2.3, OMAP_MUX_MODE7 | AM33XX_PIN_INPUT */
+								>;
+						};
+
+};
+
+&i2c1{
+		status = "okay";
+		pinctrl-names = "default";
+		pinctrl-0 = <&bb_i2c1_pins>;
+
+		/* this is the configuration part */
+		clock-frequency = <100000>;
+
+		#address-cells = <1>;
+		#size-cells = <0>;
+
+		/* add any i2c devices on the bus here */
+
+		/* commented out example of a touchscreen (taken from BB-BONE-LCD7-01-00A4) */
+		touchscreen@41 {
+				pinctrl-0 = <&bb_irq_pins>;
+
+				compatible = "ilitek,ili251x";
+				reg = <0x41>;
+				interrupt-parent = <&gpio1>;
+				interrupts = <18 2>;
+		};
+};
+
+&epwmss2{
+	status = "okay";
+};
+
+&ehrpwm2{
+	pinctrl-names = "default";
+	pinctrl-0 = <&pwm_backlight_pins>;
+	status = "okay";
+};
+
+/{
+			cfg_btn {
+				compatible = "gpio-keys";
+				status = "okay";
+				#address-cells = <1>;
+				#size-cells = <0>;
+				autorepeat;
+				pinctrl-names = "default";
+				pinctrl-0 = <&bb_configbtn_pins>;
+				configbtn@0
+				{
+						linux,code = <0x100>; //100
+						//linux,input-type = <0x05>;
+						label = "config_btn";
+						gpios = <&gpio1 16 1>;	// active low
+				};
+			};
+
+			mid_switch {
+				mid_switch@0{
+					label = "mid_switch";
+					gpios = <&gpio1 17 0>;
+				};
+			};
+
+			resistance_indice_carte {
+				resistance116_indice_carte_pin@1 {
+						label = "resistance_116";
+						line-name = "resistance_116";
+						gpios = <&gpio2 2 0>;
+				};
+				resistance117_indice_carte_pin@2 {
+						label = "resistance_117";
+						line-name = "resistance_117";
+						gpios = <&gpio2 3 0>;
+				};
+			};
+};
+
+&i2c0{
+		status = "okay";
+};
+
+&i2c2{
+		status = "disable";
+};
+
+/{
+			leds {
+				pinctrl-names = "default";
+				pinctrl-0 = <&led_pin>;
+				compatible = "gpio-leds";
+
+				led_red_pin@1 {
+						label = "red_led";
+						gpios = <&gpio1 13 0>;
+						default-state = "off";
+				};
+				led_green_pin@2 {
+						label = "green_led";
+						gpios = <&gpio1 12 0>;
+						default-state = "on";
+				};
+			};
+
+			buzzer {
+				buzzer@0{
+					label = "buzzer";
+					line-name = "buzzer";
+					gpios = <&gpio3 19 GPIO_ACTIVE_HIGH>;
+				};
+			};
+
+			rs485 {
+				rs485@0{
+					label = "rs485";
+					line-name = "rs485";
+					gpios = <&gpio1 19 GPIO_ACTIVE_HIGH>;
+				};
+			};
+
+			dalle_tactile_reset {
+				pinctrl-names = "default";
+				pinctrl-0 = <&dalle_tactile_reset_pin>;
+				compatible = "gpio-leds";
+				status = "okay";
+				dalle_tactile_reset_pin@1 {
+						label = "dalle_tactile_reset";
+						line-name = "dalle_tactile_reset";
+						gpios = <&gpio0 15 0>;
+						default-state = "off";
+				};
+			};
+						
+			backlight {
+				status = "okay";
+				compatible = "pwm-backlight";
+				pwms = <&ehrpwm2 0 500000 0>;
+				brightness-levels = <
+					15 15 15 15 15 15 15 15 15 15
+					15 15 15 15 15 15 16 17 18 19
+					20 21 22 23 24 25 26 27 28 29
+					30 31 32 33 34 35 36 37 38 39
+					40 41 42 43 44 45 46 47 48 49
+					50 51 52 53 54 55 56 57 58 59
+					60 61 62 63 64 65 66 67 68 69
+					70 71 72 73 74 75 76 77 78 79
+					80 81 82 83 84 85 86 87 88 89
+					90 91 92 93 94 95 96 97 98 99
+					100
+				>;
+				default-brightness-level = <50>;
+			};
+};
+
+&uart2 {
+	pinctrl-names = "default";
+	pinctrl-0 = <&uart2_pins>;
+
+	status = "okay";
+};
+
+/*
+	__symbols__ {
+		aliases = "/aliases";
+		mpu_gate = "/cpus/idle-states/mpu_gate";
+		cpu0_opp_table = "/opp-table";
+		ocp = "/ocp";
+		epwmss1 = "/ocp/epwmss@48302000";
+		eqep1 = "/ocp/epwmss@48302000/eqep@0x48302180";
+		ehrpwm1 = "/ocp/epwmss@48302000/pwm@48302200";
+		epwmss2 = "/ocp/epwmss@48304000";
+		ecap2 = "/ocp/epwmss@48304000/ecap@48304100";
+		eqep2 = "/ocp/epwmss@48304000/eqep@0x48304180";
+		ehrpwm2 = "/ocp/epwmss@48304000/pwm@48304200";
+	};*/
+
+&tscadc {
+    status = "okay";
+};
+
+&am335x_adc {
+    ti,adc-channels = <0 1 2>;
+};
+
-- 
2.34.1

